{
	"info": {
		"_postman_id": "87904731-2ba6-4ae6-9dae-f5a9a9d618c9",
		"name": "E-Learning - Full Test Flow (Login + Course)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "38671139"
	},
	"item": [
		{
			"name": "[POST] Login & Get Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200 OK\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"// SỬA LỖI: Đổi 'accessToken' thành 'access_token' để khớp với response",
							"pm.test(\"Response có 'data' và 'access_token'\", function () {",
							"    pm.expect(jsonData).to.have.property('data');",
							"    pm.expect(jsonData.data).to.have.property('access_token');",
							"    pm.expect(jsonData.data.access_token).to.not.be.null;",
							"});",
							"",
							"// SỬA LỖI: Lấy đúng 'access_token'",
							"var accessToken = jsonData.data.access_token;",
							"pm.collectionVariables.set(\"authToken\", accessToken);",
							"",
							"console.log(\"Đã đăng nhập thành công. Token đã được lưu.\");"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"packages": {},
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"ngoloc3304@gmail.com\",\n    \"password\": \"Ngoloc12@\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/oauth/token",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"oauth",
						"token"
					]
				},
				"description": "Đăng nhập để lấy token. Token sẽ được tự động lưu vào biến {{authToken}}."
			},
			"response": []
		},
		{
			"name": "[POST] Create Course",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// 1. Lấy một số ngẫu nhiên từ Postman (ĐÃ SỬA LỖI)\r",
							"var randomNum = pm.variables.replaceIn('{{$randomInt}}');\r",
							"\r",
							"// 2. Tạo một tiêu đề ngẫu nhiên\r",
							"var randomTitle = \"Khóa học tự động \" + randomNum;\r",
							"\r",
							"// 3. LƯU LẠI tiêu đề này để tab \"Tests\" có thể dùng\r",
							"pm.collectionVariables.set(\"currentCourseTitle\", randomTitle);\r",
							"\r",
							"// 4. TỰ TẠO RA TOÀN BỘ BODY (Theo đúng body của bạn)\r",
							"var newCourseBody = {\r",
							"    \"category\": \"AI_AND_MACHINE_LEARNING\",\r",
							"    \"courseStatus\": \"ARCHIVED\",\r",
							"    \"description\": \"string\",\r",
							"    \"image\": \"string\",\r",
							"    \"level\": \"ADVANCED\",\r",
							"    \"price\": 0,\r",
							"    \"title\": randomTitle // Dùng title ngẫu nhiên\r",
							"};\r",
							"\r",
							"// 5. Gán body này cho request sắp chạy\r",
							"pm.request.body.update({\r",
							"    mode: 'raw',\r",
							"    raw: JSON.stringify(newCourseBody)\r",
							"});\r",
							"\r",
							"// 6. Đảm bảo Header Content-Type là application/json\r",
							"pm.request.headers.upsert({\r",
							"    key: 'Content-Type',\r",
							"    value: 'application/json'\r",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"// 1. Kiểm tra Status Code (Mong đợi 200 OK)",
							"pm.test(\"Status code is 200 OK\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"// 2. Parse JSON",
							"var jsonData = pm.response.json();",
							"",
							"// 3. Kiểm tra title trả về khớp với title ngẫu nhiên đã tạo",
							"var expectedTitle = pm.collectionVariables.get(\"currentCourseTitle\");",
							"pm.test(\"Response title khớp với title đã tạo\", function () {",
							"     pm.expect(jsonData.data.title).to.eql(expectedTitle);",
							"});",
							"",
							"// 4. Lấy và kiểm tra courseId (Theo yêu cầu mới)",
							"pm.test(\"Response body có 'data' và 'courseId'\", function () {",
							"    pm.expect(jsonData).to.have.property('data');",
							"    pm.expect(jsonData.data).to.have.property('courseId');",
							"    pm.expect(jsonData.data.courseId).to.not.be.null;",
							"});",
							"",
							"// 5. Lưu ID để dùng cho các request sau",
							"var courseId = jsonData.data.courseId;",
							"pm.collectionVariables.set(\"courseId\", courseId);",
							"",
							"console.log(\"Đã tạo/cập nhật khóa học. Đã lưu courseId: \" + courseId);"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{authToken}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses"
					]
				},
				"description": "Tạo một khóa học mới. Yêu cầu quyền INSTRUCTOR."
			},
			"response": []
		},
		{
			"name": "[POST] Create Course - FAIL - Title is NULL",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 400 Bad Request\", function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"// Kiểm tra lỗi validation trả về từ GlobalExceptionHandler",
							"pm.test(\"Error code is VAL.CR0101 (Title must not be blank)\", function () {",
							"    pm.expect(jsonData).to.have.property('error');",
							"    pm.expect(jsonData.error.code).to.eql(\"VAL.CR0101\");",
							"    pm.expect(jsonData.error.message).to.include(\"Title must not be blank\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{authToken}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"title\": null,\n    \"category\": \"AI_AND_MACHINE_LEARNING\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses"
					]
				},
				"description": "Test kịch bản thất bại: Tạo khóa học với 'title' là null. Mong đợi lỗi @NotBlank."
			},
			"response": []
		},
		{
			"name": "[POST] Create Course - FAIL - Category is NULL",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 400 Bad Request\", function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"// Kiểm tra lỗi validation trả về từ GlobalExceptionHandler",
							"pm.test(\"Error code is VAL.CR0102 (Category must not be null)\", function () {",
							"    pm.expect(jsonData).to.have.property('error');",
							"    pm.expect(jsonData.error.code).to.eql(\"VAL.CR0102\");",
							"    pm.expect(jsonData.error.message).to.include(\"Category must not be null\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{authToken}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"title\": \"Khóa học test Category Null\",\n    \"category\": null\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses"
					]
				},
				"description": "Test kịch bản thất bại: Tạo khóa học với 'category' là null. Mong đợi lỗi @NotNull."
			},
			"response": []
		},
		{
			"name": "[GET] Get Course By ID (Public)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200 OK\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"// Lấy ID và Title đã lưu từ request [POST] Create Course",
							"var expectedId = pm.collectionVariables.get(\"courseId\");",
							"var expectedTitle = pm.collectionVariables.get(\"currentCourseTitle\"); // SỬA LỖI: Lấy đúng tên biến",
							"",
							"pm.test(\"Course ID khớp với khóa đã tạo\", function () {",
							"    // SỬA LỖI: Tên trường là 'courseId', không phải 'id'",
							"    pm.expect(jsonData.data.courseId).to.eql(expectedId);",
							"});",
							"",
							"pm.test(\"Course Title khớp với khóa đã tạo\", function () {",
							"    pm.expect(jsonData.data.title).to.eql(expectedTitle);",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses/{{courseId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses",
						"{{courseId}}"
					]
				},
				"description": "Lấy thông tin chi tiết một khóa học (public)."
			},
			"response": []
		},
		{
			"name": "[PUT] Update Course",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200 OK\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"Dữ liệu trả về đã được cập nhật chính xác\", function () {",
							"    // 1. Kiểm tra title",
							"    pm.expect(jsonData.data.title).to.include(\"ĐÃ CẬP NHẬT\");",
							"    ",
							"    // 2. Kiểm tra price",
							"    pm.expect(jsonData.data.price).to.eql(120000);",
							"    ",
							"    // 3. Kiểm tra category",
							"    pm.expect(jsonData.data.category).to.eql(\"AI_AND_MACHINE_LEARNING\");",
							"    ",
							"    // 4. BỎ dòng kiểm tra level vì nó không có trong response",
							"    // pm.expect(jsonData.data.level).to.eql(\"INTERMEDIATE\"); ",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{authToken}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"category\": \"AI_AND_MACHINE_LEARNING\",\n    \"title\": \"ĐÃ CẬP NHẬT - Khóa học Postman {{$randomInt}}\",\n    \"description\": \"Mô tả đã được cập nhật.\",\n    \"price\": 120000,\n    \"tagIds\": []\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses/{{courseId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses",
						"{{courseId}}"
					]
				},
				"description": "Cập nhật khóa học. Yêu cầu quyền INSTRUCTOR."
			},
			"response": []
		},
		{
			"name": "[PUT] Update Course - FAIL - Title is NULL",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 400 Bad Request\", function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"Error code is VAL.CR0101 (Title must not be blank)\", function () {",
							"    pm.expect(jsonData).to.have.property('error');",
							"    pm.expect(jsonData.error.code).to.eql(\"VAL.CR0101\");",
							"    pm.expect(jsonData.error.message).to.include(\"Title must not be blank\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{authToken}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"title\": null,\n    \"category\": \"AI_AND_MACHINE_LEARNING\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses/{{courseId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses",
						"{{courseId}}"
					]
				},
				"description": "Test kịch bản thất bại: Cập nhật khóa học với 'title' là null. Mong đợi lỗi @NotBlank."
			},
			"response": []
		},
		{
			"name": "[PUT] Update Course - FAIL - Category is NULL",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 400 Bad Request\", function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"Error code is VAL.CR0102 (Category must not be null)\", function () {",
							"    pm.expect(jsonData).to.have.property('error');",
							"    pm.expect(jsonData.error.code).to.eql(\"VAL.CR0102\");",
							"    pm.expect(jsonData.error.message).to.include(\"Category must not be null\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{authToken}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"title\": \"Khóa học test Category Null khi Update\",\n    \"category\": null\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses/{{courseId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses",
						"{{courseId}}"
					]
				},
				"description": "Test kịch bản thất bại: Cập nhật khóa học với 'category' là null. Mong đợi lỗi @NotNull."
			},
			"response": []
		},
		{
			"name": "[GET] Get All Courses (Public)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200 OK\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"// SỬA LỖI: 'data' là một mảng (Array), không phải object",
							"pm.test(\"Response 'data' là một mảng (Array)\", function () {",
							"    pm.expect(jsonData.data).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Danh sách khóa học không được rỗng\", function () {",
							"    // Kiểm tra xem mảng 'data' có phần tử hay không",
							"    pm.expect(jsonData.data.length).to.be.above(0, \"Danh sách khóa học không được rỗng\");",
							"});",
							"",
							"// (Tùy chọn) Kiểm tra phần tử đầu tiên",
							"pm.test(\"Khóa học đầu tiên có 'courseId' và 'title'\", function () {",
							"    pm.expect(jsonData.data[0]).to.have.property('courseId');",
							"    pm.expect(jsonData.data[0]).to.have.property('title');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses?page=0&size=5",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses"
					],
					"query": [
						{
							"key": "page",
							"value": "0"
						},
						{
							"key": "size",
							"value": "5"
						}
					]
				},
				"description": "Lấy danh sách các khóa học (public, có phân trang)."
			},
			"response": []
		},
		{
			"name": "[DELETE] Delete Course",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200 OK\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"Response message is correct\", function () {",
							"    // SỬA LỖI: Đổi .message thành .data",
							"    pm.expect(jsonData.data).to.eql(\"Course deleted successfully\");",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{authToken}}",
							"type": "string"
						}
					]
				},
				"method": "DELETE",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses/{{courseId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses",
						"{{courseId}}"
					]
				},
				"description": "Xóa khóa học. Yêu cầu quyền INSTRUCTOR."
			},
			"response": []
		},
		{
			"name": "[GET] Get Deleted Course (Expect 404)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 404 Not Found\", function () {",
							"    pm.response.to.have.status(404);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"Phải có object 'error' và code 'COURSE.NOT_FOUND'\", function () {",
							"    pm.expect(jsonData).to.have.property('error');",
							"    pm.expect(jsonData.error.code).to.eql(\"COURSE.NOT_FOUND\");",
							"});",
							"",
							"pm.test(\"Error message có chứa 'Course not found'\", function () {",
							"    // SỬA LỖI: Lấy từ .error.message và dùng .include",
							"    pm.expect(jsonData.error.message).to.include(\"Course not found\");",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/v1/courses/{{courseId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"courses",
						"{{courseId}}"
					]
				},
				"description": "Test kịch bản thất bại: Cố gắng lấy một khóa học đã bị xóa."
			},
			"response": []
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "https://api-coursevo-dev.id.vn"
		},
		{
			"key": "authToken",
			"value": "",
			"description": {
				"content": "Sẽ được tự động điền bởi request [POST] Login",
				"type": "text/plain"
			}
		},
		{
			"key": "courseId",
			"value": ""
		},
		{
			"key": "courseTitle",
			"value": ""
		},
		{
			"key": "randomTitle",
			"value": ""
		},
		{
			"key": "currentCourseTitle",
			"value": ""
		}
	]
}